TCP

* 面向连接的，可靠的流协议，面向字节流
* 提供可靠传输：顺序控制、重发控制、流量控制、拥塞控制
* 每条TCP连接只能是点到点的

UDP

* 面向无连接的，不提供复杂的控制机制，面向报文
* 传输速度更快，实时性高
* 支持一对一、一对多、多对对的交互通信
* 适合于：包总量少的通信、音视频等多媒体通信、广播/多播通信

TCP核心

1. 通过序列号和确认应答提高可靠性

   ACK：

   * 确认应答ACK：接收端返回收到消息的确认信号
   * TCP主要利用确认应答实现数据的可靠传输
   * 发送端发送的数据包丢失或接收端回送的确认应答丢失都会导致发送方进行数据重发

   序列号

   * 序列号是按顺序给发送数据的每一个字节都标上号码的编号
   * 接收端查询接收数据TCP首部中的序列号和数据长度，将自己接下来应该接收的序号作为确认应答返送回去
   * 以此实现TCP的可靠传输

2. 重发超时如何确定

   * 重发超时是指在重发数据之前，等待确认应答到来的哪个时间间隔；如果超过这个时间仍未收到确认应答，发送端将进行数据重发
   * TCP在每次发包时都会计算往返时间及其偏差，重发超时就是比这个往返时间和偏差的和稍微大一点的值
   * 当然，数据也不会被无限的重发，当达到一定次数之后就会强制关闭连接

3. 连接管理

   * 在数据通信之前，通过TCP首部发送一个SYN包作为建立连接的请求，等待确认应答；如果未收到确认应答，就不会建立通信；同时，在通信结束时会进行断开连接的处理（FIN包）
   * 建立一次TCP连接需要来回发送7个包（三次握手、四次挥手）

4. 以段为单位发送数据

   * 在建立TCP连接请求的同时，也可以确定发送数据包的单位（最大消息长度）
   * 最大消息长度最好是IP中不会被分片处理的最大数据长度
   * MSS是在三次握手的时候，在两端主机之间被计算得出；两端主机在建立连接的请求时，在TCP首部写入MSS选项，告诉对方自己的接口能够适应的MSS大小；然后在两者之间选择一个较小的值投入使用

5. 利用窗口控制提高速度

   * 使用滑动窗口代替原来每发送一个段就要等待一次确认应答的场景
   * 窗口大小就是无需等待确认应答而可以继续发送数据的最大值
   * 为防止丢包，发送端主机会设置缓存区保留待被重传的数据，直到收到确认应答

6. 窗口控制和重发控制

   * 使用窗口控制时，某些确认应答即便丢失也无需重发，可以通过下一个确认应答进行确认

   * 在窗口比较大，又出现报文段丢失的情况下，同一个序号的确认应答将被重复不断地返回
   * 发端主机如果连续3次收到同一个确认应答，就会将其所对应的数据进行重发

7. 流控制

   * 发送端根据接收端的实际接收能力控制发送的数据量
   * 接收端主机向发送端主机通知自己可以接收数据的大小，于是发送端会发送不超过这个大小的数据
   * 发送端会时不时的发送一个叫做窗口探测的数据段

8. 拥塞控制

   * TCP为了防止网路瘫痪，在通信一开始时就会通过一个叫做慢启动的算法，对发送的数据量进行控制
   * 在慢启动时，将拥塞窗口的大小设置为1，之后每收到一次确认应答，就将拥塞窗口的大小加1
   * 在发包时，将接收端通知的窗口大小和拥塞窗口大小做比较，选择较小的值